pipeline {
  agent any
  tools { nodejs "v9.9.0" }

  stages {

    stage('dependencies') {
      steps {
        sh "yarn install --frozen-lockfile"
      }
    }

    stage('tests') {
      steps {
        sh "yarn test"
      }
    }

    stage('build') {
      steps {
        sh "yarn build"
      }
    }

    stage('demo container') {
      steps {
        sh "echo '...building and deploying the container...'"
      }
    }

    stage('BrowserStack') {
      steps {
        sh "echo '...running the browserstack tests...'"
      }
    }

    stage('release') {
      steps {
        sh "echo '...creating tag and releasing to npm...'"
      }
    }
  }

  post {
    success {
      slackSend (channel: '#cake-team-tech', color: 'good', failOnError: true, message: ":shipit: -> tracking-opt-in on ${params.branch} :fandom2017: :flag-eu: :gdpr: :ok_hand:!")
    }

    failure {
      slackSend (channel: '#cake-team-tech', color: 'warning', failOnError: true, message: ":sadface: Release of tracking-opt-in on ${params.branch} :flag-eu: :gdpr: :doom_look: failed!")
    }
  }
}
